# –ú–µ—Ö–∞–Ω–∏–∫–∞ –∞—É–∫—Ü–∏–æ–Ω–æ–≤

[‚Üê –ö README](../../README.ru.md) ¬∑ [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](./architecture.md) ¬∑ [API](./api.md) ¬∑ [–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å](./concurrency.md) ¬∑ [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](./testing.md) ¬∑ [–î–µ–ø–ª–æ–π](./deployment.md)

---

## –ú–Ω–æ–≥–æ—Ä–∞—É–Ω–¥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—ã–±—ã–≤–∞–Ω–∏—è

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤ ¬´–∫—Ç–æ –±–æ–ª—å—à–µ –∑–∞–ø–ª–∞—Ç–∏—Ç¬ª, —ç—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–ª–æ–∂–Ω—ã–π –º–Ω–æ–≥–æ—Ä–∞—É–Ω–¥–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—ã–±—ã–≤–∞–Ω–∏—è, –≥–¥–µ –ø—Ä–µ–¥–º–µ—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Ä–∞—É–Ω–¥–∞–º.

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ê—É–∫—Ü–∏–æ–Ω —Å 10 –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –∫–∞–∫ 3+5+2:

| –†–∞—É–Ω–¥ | –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ | –ü—Ä–µ–¥–º–µ—Ç—ã | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
|-------|------------|----------|--------------|
| 1 | –¢–æ–ø-3 —É—á–∞—Å—Ç–Ω–∏–∫–∞ | –ü—Ä–µ–¥–º–µ—Ç—ã #1-3 | 30 –º–∏–Ω |
| 2 | –¢–æ–ø-5 –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è | –ü—Ä–µ–¥–º–µ—Ç—ã #4-8 | 20 –º–∏–Ω |
| 3 | –¢–æ–ø-2 –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è | –ü—Ä–µ–¥–º–µ—Ç—ã #9-10 | 15 –º–∏–Ω |

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∞—É–∫—Ü–∏–æ–Ω–∞

```
PENDING ‚îÄ‚îÄ[—Å—Ç–∞—Ä—Ç]‚îÄ‚îÄ‚ñ∫ ACTIVE ‚îÄ‚îÄ[–≤—Å–µ —Ä–∞—É–Ω–¥—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã]‚îÄ‚îÄ‚ñ∫ COMPLETED
                        ‚îÇ
                        ‚îú‚îÄ‚îÄ –†–∞—É–Ω–¥ 1: –ê–∫—Ç–∏–≤–µ–Ω
                        ‚îÇ   ‚îú‚îÄ‚îÄ –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –≤—ã–±—Ä–∞–Ω—ã, —Å—Ç–∞–≤–∫–∏ —Å–ø–∏—Å–∞–Ω—ã
                        ‚îÇ   ‚îî‚îÄ‚îÄ –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ –†–∞—É–Ω–¥ 2
                        ‚îÇ
                        ‚îú‚îÄ‚îÄ –†–∞—É–Ω–¥ 2: –ê–∫—Ç–∏–≤–µ–Ω
                        ‚îÇ   ‚îú‚îÄ‚îÄ –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è
                        ‚îÇ   ‚îî‚îÄ‚îÄ –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ –†–∞—É–Ω–¥ 3
                        ‚îÇ
                        ‚îî‚îÄ‚îÄ –†–∞—É–Ω–¥ 3: –ê–∫—Ç–∏–≤–µ–Ω
                            ‚îú‚îÄ‚îÄ –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
                            ‚îî‚îÄ‚îÄ –û—Å—Ç–∞–≤—à–∏–µ—Å—è —Å—Ç–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã
```

### –ü–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π

```typescript
// –°–æ—Å—Ç–æ—è–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞
type AuctionStatus = 'pending' | 'active' | 'completed';

// –°–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞—É–Ω–¥–∞
type RoundStatus = 'pending' | 'active' | 'completed';

// –°–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–∞–≤–∫–∏
type BidStatus = 'active' | 'won' | 'lost' | 'refunded';
```

## –ú–æ–¥–µ–ª—å —Å—Ç–∞–≤–æ–∫

### –û–¥–Ω–∞ —Å—Ç–∞–≤–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–≤–Ω–æ –æ–¥–Ω—É —Å—Ç–∞–≤–∫—É –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω:
- –ü–µ—Ä–≤–∞—è —Å—Ç–∞–≤–∫–∞ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç–∞–≤–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —Å—É–º–º—É
- –°—Ç–∞–≤–∫–∏ –Ω–µ–ª—å–∑—è —É–º–µ–Ω—å—à–∏—Ç—å –∏–ª–∏ –æ—Ç–æ–∑–≤–∞—Ç—å

```typescript
// –ü–µ—Ä–≤–∞—è —Å—Ç–∞–≤–∫–∞: –°–æ–∑–¥–∞–Ω–∏–µ
POST /api/auctions/123/bid { amount: 100 }
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –°—Ç–∞–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —Å amount=100

// –í—Ç–æ—Ä–∞—è —Å—Ç–∞–≤–∫–∞: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ
POST /api/auctions/123/bid { amount: 150 }
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ç–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ amount=150
// –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ 50 –∑–∞–º–æ—Ä–æ–∂–µ–Ω—ã —Å –±–∞–ª–∞–Ω—Å–∞
```

### –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã

–°—É–º–º—ã —Å—Ç–∞–≤–æ–∫ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã –≤ —Ä–∞–º–∫–∞—Ö –∞—É–∫—Ü–∏–æ–Ω–∞:
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥
- –ï—Å–ª–∏ —Å—É–º–º–∞ –∑–∞–Ω—è—Ç–∞ ‚Äî API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 409 Conflict

### –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∏—á—å–∏—Ö

–ü—Ä–∏ —Ä–∞–≤–Ω—ã—Ö —Å—É–º–º–∞—Ö (–Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∏–∑-–∑–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏):
- –ü–æ–±–µ–∂–¥–∞–µ—Ç –±–æ–ª–µ–µ —Ä–∞–Ω–Ω—è—è —Å—Ç–∞–≤–∫–∞
- –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π score –≤ Redis ZSET –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –ü–µ—Ä–µ–Ω–æ—Å —Å—Ç–∞–≤–æ–∫ (Bid Carryover)

–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞—É–Ω–¥–∞ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
–†–∞—É–Ω–¥ 1 –∑–∞–≤–µ—Ä—à—ë–Ω —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏, 3 –ø–æ–±–µ–¥–∏—Ç–µ–ª—è:
‚îú‚îÄ‚îÄ –¢–æ–ø 3 ‚Üí status: 'won', —É–¥–∞–ª–µ–Ω—ã –∏–∑ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
‚îî‚îÄ‚îÄ –ù–∏–∂–Ω–∏–µ 7 ‚Üí status: 'lost', –Ω–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –†–∞—É–Ω–¥–∞ 2
    ‚îî‚îÄ‚îÄ –ù–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –ø–æ–º–µ—á–µ–Ω–∞: carriedOver=true, originalRound=1
```

### –ü–æ–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞

```typescript
{
  carriedOver: boolean;   // true –µ—Å–ª–∏ –∞–≤—Ç–æ-–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞
  originalRound: number;  // —Ä–∞—É–Ω–¥, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ø–µ—Ä–≤—ã–µ —Å–¥–µ–ª–∞–ª —Å—Ç–∞–≤–∫—É
}
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ —Å—Ç–∞–≤–∫–∏:

```
üîÑ –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞!

–ê—É–∫—Ü–∏–æ–Ω: "–†–µ–¥–∫–∞—è NFT –∫–æ–ª–ª–µ–∫—Ü–∏—è"
–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ 500 TON –Ω–µ –≤–æ—à–ª–∞ –≤ —Ç–æ–ø-3 –≤ –†–∞—É–Ω–¥–µ 1.
–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –†–∞—É–Ω–¥ 2.

–£–¥–∞—á–∏!
```

### WebSocket —Å–æ–±—ã—Ç–∏–µ

Frontend –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `bid-carryover`:

```typescript
{
  auctionId: string;
  odId: string;
  odName: string;
  amount: number;
  fromRound: number;
  toRound: number;
}
```

## –ê–Ω—Ç–∏-—Å–Ω–∞–π–ø–∏–Ω–≥ –∑–∞—â–∏—Ç–∞

–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å—Ç–∞–≤–∫–∞–º–∏ –≤ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–µ–∫—É–Ω–¥—É, –ø—Ä–æ–¥–ª–µ–≤–∞—è —Ä–∞—É–Ω–¥—ã –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞–≤–æ–∫ –±–ª–∏–∂–µ –∫ –∫–æ–Ω—Ü—É.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```typescript
{
  antiSnipingEnabled: true,
  antiSnipingWindowMinutes: 5,      // –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ 5 –º–∏–Ω
  antiSnipingExtensionMinutes: 5,   // –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –Ω–∞ 5 –º–∏–Ω—É—Ç
  maxAntiSnipingExtensions: 6       // –î–æ 6 –ø—Ä–æ–¥–ª–µ–Ω–∏–π (–º–∞–∫—Å. 30 –º–∏–Ω)
}
```

### –ü—Ä–∏–º–µ—Ä —Ç–∞–π–º–ª–∞–π–Ω–∞

```
–ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω–µ—Ü —Ä–∞—É–Ω–¥–∞: 10:00:00
–û–∫–Ω–æ –∞–Ω—Ç–∏-—Å–Ω–∞–π–ø–∏–Ω–≥–∞: 5 –º–∏–Ω—É—Ç (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ 09:55:00)

–¢–∞–π–º–ª–∞–π–Ω:
  09:54:59 - –°—Ç–∞–≤–∫–∞ ‚Üí –ë–µ–∑ –ø—Ä–æ–¥–ª–µ–Ω–∏—è (–≤–Ω–µ –æ–∫–Ω–∞)
  09:55:01 - –°—Ç–∞–≤–∫–∞ ‚Üí –†–∞—É–Ω–¥ –ø—Ä–æ–¥–ª—ë–Ω –¥–æ 10:05:00 (–ø—Ä–æ–¥–ª–µ–Ω–∏–µ #1)
  10:04:30 - –°—Ç–∞–≤–∫–∞ ‚Üí –†–∞—É–Ω–¥ –ø—Ä–æ–¥–ª—ë–Ω –¥–æ 10:10:00 (–ø—Ä–æ–¥–ª–µ–Ω–∏–µ #2)
  ... –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å. –ø—Ä–æ–¥–ª–µ–Ω–∏–π
```

### WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```typescript
socket.emit('anti-sniping', {
  auctionId: '123',
  round: 1,
  newEndTime: '2024-01-15T10:05:00Z',
  extensionNumber: 1,
  maxExtensions: 6
});
```

## –°–µ—Ä–≤–µ—Ä–Ω—ã–π –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç

–°–µ—Ä–≤–µ—Ä —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

### –ü–æ—á–µ–º—É —Å–µ—Ä–≤–µ—Ä–Ω—ã–π?

- –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —á–∞—Å—ã –º–æ–≥—É—Ç –¥—Ä–µ–π—Ñ–æ–≤–∞—Ç—å
- –ê–Ω—Ç–∏-—Å–Ω–∞–π–ø–∏–Ω–≥ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ç–∞–π–º–µ—Ä–∞–º–∏

### –ì–∏–±—Ä–∏–¥–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

```typescript
// Frontend useCountdown —Ö—É–∫
// 1. –ü–æ–ª—É—á–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –æ—Ç—Å—á—ë—Ç –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
// 2. –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ—Ç –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
// 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–∏
```

### WebSocket —Å–æ–±—ã—Ç–∏–µ

```typescript
socket.emit('countdown', {
  auctionId: string;
  round: number;
  remainingSeconds: number;
  endTime: string;
});
```

## –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –º–æ–¥–µ–ª—å

### –¢–∏–ø—ã –±–∞–ª–∞–Ω—Å–∞

```typescript
User {
  balance: number;        // –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —Å—Ç–∞–≤–æ–∫
  frozenBalance: number;  // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∞–≤–∫–∞—Ö
}
```

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç**: –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ
```
totalValue = balance + frozenBalance + spentOnWinningBids
```

### –ü–æ—Ç–æ–∫–∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å—Ç–∞–≤–∫–∏

#### –†–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞–≤–∫–∏

```
–î–æ: balance=1000, frozen=0
–î–µ–π—Å—Ç–≤–∏–µ: –°—Ç–∞–≤–∫–∞ 300

balance  -= 300  ‚Üí  700
frozen   += 300  ‚Üí  300

–ü–æ—Å–ª–µ: balance=700, frozen=300
```

#### –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç–∞–≤–∫–∏

```
–î–æ: balance=700, frozen=300 (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ç–∞–≤–∫–∞=300)
–î–µ–π—Å—Ç–≤–∏–µ: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–æ 500 (–¥–µ–ª—å—Ç–∞=200)

balance  -= 200  ‚Üí  500
frozen   += 200  ‚Üí  500

–ü–æ—Å–ª–µ: balance=500, frozen=500
```

#### –ü–æ–±–µ–¥–∞

```
–î–æ: balance=500, frozen=500 (—Å—Ç–∞–≤–∫–∞=500)
–î–µ–π—Å—Ç–≤–∏–µ: –°—Ç–∞–≤–∫–∞ –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç

frozen   -= 500  ‚Üí  0
(–¥–µ–Ω—å–≥–∏ –ø–æ—Ç—Ä–∞—á–µ–Ω—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–º)

–ü–æ—Å–ª–µ: balance=500, frozen=0
```

#### –ü—Ä–æ–∏–≥—Ä—ã—à/–í–æ–∑–≤—Ä–∞—Ç (–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥)

```
–î–æ: balance=500, frozen=500 (—Å—Ç–∞–≤–∫–∞=500)
–î–µ–π—Å—Ç–≤–∏–µ: –ü—Ä–æ–∏–≥—Ä—ã—à –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —Ä–∞—É–Ω–¥–µ, –≤–æ–∑–≤—Ä–∞—Ç

frozen   -= 500  ‚Üí  0
balance  += 500  ‚Üí  1000

–ü–æ—Å–ª–µ: balance=1000, frozen=0
```

#### –ü–µ—Ä–µ–Ω–æ—Å (–ù–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥)

```
–î–æ: balance=500, frozen=500 (—Å—Ç–∞–≤–∫–∞=500)
–î–µ–π—Å—Ç–≤–∏–µ: –ü—Ä–æ–∏–≥—Ä—ã—à –≤ –†–∞—É–Ω–¥–µ 1, –ø–µ—Ä–µ–Ω–æ—Å –≤ –†–∞—É–Ω–¥ 2

frozen –æ—Å—Ç–∞—ë—Ç—Å—è 500 (–≤—Å—ë –µ—â—ë –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)
–ù–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –†–∞—É–Ω–¥–∞ 2 —Å carriedOver=true

–ü–æ—Å–ª–µ: balance=500, frozen=500 (—Å—Ç–∞–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –≤ –†–∞—É–Ω–¥–µ 2)
```

## –õ–∏–¥–µ—Ä–±–æ—Ä–¥

Real-time —Ä–µ–π—Ç–∏–Ω–≥ –Ω–∞ Redis ZSET —Å O(log N) –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏.

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç —Å—Ç–∞–≤–∫—É
2. ZADD –≤ Redis –ª–∏–¥–µ—Ä–±–æ—Ä–¥ (O(log N))
3. WebSocket —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ new-bid
4. Frontend –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
5. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞—É–Ω–¥–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ ZREM
```

### API –æ—Ç–≤–µ—Ç

```typescript
GET /api/auctions/:id/leaderboard

{
  leaderboard: [
    { rank: 1, odId: 'abc', odName: '–ê–ª–∏—Å–∞', amount: 500, isWinning: true },
    { rank: 2, odId: 'def', odName: '–ë–æ–±', amount: 450, isWinning: true },
    { rank: 3, odId: 'ghi', odName: '–ß–∞—Ä–ª–∏', amount: 400, isWinning: true },
    { rank: 4, odId: 'jkl', odName: '–î–µ–π–≤', amount: 350, isWinning: false },
  ],
  currentRound: 1,
  winnersThisRound: 3,
  totalBids: 15
}
```

### Fallback

–ï—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ MongoDB –∑–∞–ø—Ä–æ—Å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏.

## –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞

–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è cron-–∑–∞–¥–∞—á–µ–π –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥:

```typescript
async completeRound(auction, roundNumber) {
  // 1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –∏–∑ Redis –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ (–∏–ª–∏ MongoDB fallback)
  const bids = await leaderboardService.getAll(auctionId);

  // 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π (—Ç–æ–ø N –ø–æ roundConfig)
  const winnersCount = auction.roundsConfig[roundNumber - 1].winnersCount;
  const winners = bids.slice(0, winnersCount);
  const losers = bids.slice(winnersCount);

  // 3. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
  for (const bid of winners) {
    bid.status = 'won';
    await leaderboardService.removeBid(auctionId, odId);
    await User.updateOne({ _id: odId }, { $inc: { frozenBalance: -bid.amount } });
    await notificationsService.notifyWin(odId, ...);
  }

  // 4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö
  if (isLastRound) {
    // –í–æ–∑–≤—Ä–∞—Ç –≤—Å–µ–º –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–º
    for (const bid of losers) {
      bid.status = 'refunded';
      await User.updateOne(
        { _id: odId },
        { $inc: { frozenBalance: -bid.amount, balance: bid.amount } }
      );
    }
  } else {
    // –ü–µ—Ä–µ–Ω–æ—Å –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥
    for (const bid of losers) {
      bid.status = 'lost';
      await Bid.create({
        ...bid,
        round: roundNumber + 1,
        status: 'active',
        carriedOver: true,
        originalRound: bid.originalRound || roundNumber
      });
      await notificationsService.notifyBidCarryover(odId, ...);
      eventsGateway.emitBidCarryover(...);
    }
  }

  // 5. –ù–∞—á–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∞—É–∫—Ü–∏–æ–Ω
  if (isLastRound) {
    auction.status = 'completed';
    timerService.stop(auctionId);
  } else {
    auction.currentRound++;
    timerService.restart(auctionId, newEndTime);
  }
}
```
